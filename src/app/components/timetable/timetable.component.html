<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-7">
            <br>
            <table class="table table-striped table-dark" *ngIf="timetable && subjects">
                <thead>
                    <tr>
                        <th scope="col"></th>
                        <th scope="col">Lunes</th>
                        <th scope="col">Martes</th>
                        <th scope="col">Miercoles</th>
                        <th scope="col">Jueves</th>
                        <th scope="col">Viernes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let subjectsRow of timetable.subjects; let i=index">
                        <th scope="row">
                            {{ timetable.hours[i].hour_start + ' - ' + timetable.hours[i].hour_end }}
                        </th>
                        <td *ngFor="let tSubject of subjectsRow">
                            {{ findSubject(tSubject.subject_id).name }}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-lg-3">
            <div class="card rounded-25">
                <div class="card-body">
                    <h1>Asignaturas</h1>
                    <hr>
                    <button class="btn btn-primary btn-sm mb-3 btn-block" (click)="openModal(timetableModal, 'xl')">
                        <i class="fas fa-clock"></i>
                        Horario
                    </button>
                    <div class="list-group w-100 mb-3">
                        <a class="list-group-item list-group-item-action" *ngFor="let subject of subjects">
                            {{ subject.name }}
                        </a>
                    </div>
                    <button class="btn btn-primary btn-sm mb-3 btn-block" (click)="openModal(subjectsModal, 'lg')">
                        <i class="fas fa-graduation-cap"></i>
                        Asignaturas
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #timetableModal let-close="close">
    <div class="modal-header">
        <h5 class="modal-title">Horario</h5>
        <button type="button" class="close" (click)="modal.close()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="row justify-content-center mb-4">
            <div class="col-lg-6" *ngIf="!timetable || timetable.subjects.length == 0">
                <select class="w-75 custom-select mr-2" name="rows" [(ngModel)]="rows">
                    <option [value]="i" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10]">
                        {{ i }} filas
                    </option>
                </select>
                <button class="btn btn-primary" (click)="createTable()">Generar</button>
            </div>
            <div class="col-lg-6" *ngIf="timetable">
                <select class="w-75 custom-select mr-2" name="rowIndex" [(ngModel)]="rowIndex">
                    <option [value]="i" *ngFor="let subject of timetable.subjects; let i=index">
                        Antes de la fila {{ i + 1 }}
                    </option>
                    <option [value]="(i + 1)" *ngFor="let subject of timetable.subjects; let i=index">
                        Después de la fila {{ i + 1 }}
                    </option>
                </select>
                <button class="btn btn-primary" (click)="addRows(1)">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>

        <table class="table table-striped table-dark" *ngIf="timetable && subjects">
            <thead>
                <tr>
                    <th scope="col"></th>
                    <th scope="col">Lunes</th>
                    <th scope="col">Martes</th>
                    <th scope="col">Miercoles</th>
                    <th scope="col">Jueves</th>
                    <th scope="col">Viernes</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let subjectRow of timetable.subjects; let i=index">
                    <th scope="row">
                        {{ timetable.hours[i].hour_start + ' - ' + timetable.hours[i].hour_end }}
                    </th>
                    <td *ngFor="let tSubject of subjectRow; let e=index" (click)="activateEdition(i, e)"
                        class="pointer">
                        <ng-container *ngIf="editionActivated(i, e) != true">
                            {{ findSubject(tSubject.subject_id).name }}
                        </ng-container>
                        <div class="input-group">
                            <ng-container *ngIf="editionActivated(i, e) == true">
                                <select class="custom-select" name="selectedSubject" [(ngModel)]="selectedSubject">
                                    <option disabled>
                                        {{ findSubject(tSubject.subject_id).name }}
                                    </option>
                                    <ng-container *ngFor="let subject of subjects">
                                        <option [value]="subject.id"
                                            *ngIf="findSubject(tSubject.subject_id).id !== subject.id">
                                            {{ subject.name }}
                                        </option>
                                    </ng-container>
                                </select>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-primary" type="button" (click)="updateCell(i, e)">
                                        <i class="fas fa-save"></i>
                                    </button>
                                </div>
                            </ng-container>
                        </div>
                    </td>
                    <td class="d-flex justify-content-center">
                        <button class="btn btn-sm btn-danger rounded-25" (click)="deleteRow(i)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
        <button class="btn btn-primary float-right" (click)="storeTimetable()" *ngIf="timetable">Guardar tabla</button>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="modal.close()">
            Cerrar
        </button>
    </div>
</ng-template>

<ng-template #subjectsModal let-close="close">
    <div class="modal-header">
        <h5 class="modal-title">Añadir asignaturas</h5>
        <button type="button" class="close" (click)="modal.close()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <button class="btn btn-primary float-right mb-4" (click)="createSubject()">Crear asignatura</button>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Color</th>
                    <th>Color</th>
                    <th>#</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let subject of subjects; let i=index">
                    <td>
                        <input type="text" class="form-control" [(ngModel)]="subject.name" />
                    </td>
                    <td class="p-0">
                        <app-color-picker [color]="subject.primary_color" heading="Principal" (event)="setColor('primary_color', i, $event)">
                        </app-color-picker>
                    </td>
                    <td class="p-0">
                        <app-color-picker [color]="subject.secondary_color" heading="Secundario" (event)="setColor('secondary_color', i, $event)">
                        </app-color-picker>
                    </td>
                    <td>
                        <button class="btn btn-primary rounded-25 mr-2" (click)="storeSubject(subject)" *ngIf="subject.id == 0">
                            <i class="fa fa-save"></i>
                        </button>
                        <button class="btn btn-secondary rounded-25 mr-2" (click)="updateSubject(subject)" *ngIf="subject.id != 0">
                            <i class="fas fa-pen"></i>
                        </button>
                        <button class="btn btn-danger rounded-25" (click)="deleteSubject(subject.id)">
                            <i class="fa fa-trash"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="modal.close()">
            Cerrar
        </button>
    </div>
</ng-template>
